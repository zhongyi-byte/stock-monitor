# è‚¡å¸‚ç›‘æ§ç³»ç»Ÿæ¶æ„è¯´æ˜

## ğŸ—ï¸ è§£è€¦æ¶æ„è®¾è®¡

æœ¬ç³»ç»Ÿé‡‡ç”¨**ä¸šåŠ¡é€»è¾‘ä¸éƒ¨ç½²æ–¹å¼å®Œå…¨è§£è€¦**çš„æ¶æ„è®¾è®¡ï¼Œç¡®ä¿å¯ä»¥åœ¨ä¸åŒéƒ¨ç½²ç¯å¢ƒé—´æ— ç¼è¿ç§»ã€‚

## ğŸ“Š æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å‰ç«¯ (Vue.js)  â”‚    â”‚  åç«¯ API (Flask) â”‚    â”‚  ä¸šåŠ¡é€»è¾‘å±‚      â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚ â€¢ Tailwind CSS  â”‚â—„â”€â”€â–ºâ”‚ â€¢ REST APIs     â”‚â—„â”€â”€â–ºâ”‚ â€¢ StrategyManagerâ”‚
â”‚ â€¢ å“åº”å¼è®¾è®¡     â”‚    â”‚ â€¢ è·¨åŸŸæ”¯æŒ      â”‚    â”‚ â€¢ DataFetcher   â”‚
â”‚ â€¢ å®æ—¶åˆ·æ–°      â”‚    â”‚ â€¢ é”™è¯¯å¤„ç†      â”‚    â”‚ â€¢ EmailService  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                        â”‚
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
                       â”‚   é…ç½®ç®¡ç†å±‚     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚                 â”‚
                       â”‚ â€¢ ConfigManager â”‚
                       â”‚ â€¢ ç¯å¢ƒå˜é‡æ”¯æŒ   â”‚
                       â”‚ â€¢ å¤šç¯å¢ƒé…ç½®     â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚   æ•°æ®é€‚é…å±‚     â”‚
                       â”‚                 â”‚
                       â”‚ â€¢ é€‚é…å™¨æ¨¡å¼     â”‚
                       â”‚ â€¢ å¤šæ•°æ®åº“æ”¯æŒ   â”‚
                       â”‚ â€¢ æ— ç¼åˆ‡æ¢      â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â–¼           â–¼           â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ SQLite       â”‚ â”‚ Cloudflare D1â”‚ â”‚ å…¶ä»–æ•°æ®åº“    â”‚
            â”‚ (æœ¬åœ°éƒ¨ç½²)    â”‚ â”‚ (äº‘ç«¯éƒ¨ç½²)    â”‚ â”‚ (æœªæ¥æ‰©å±•)    â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ æ ¸å¿ƒç»„ä»¶

### 1. æ•°æ®é€‚é…å±‚ (`data/database_adapter.py`)

**è®¾è®¡æ¨¡å¼**: é€‚é…å™¨æ¨¡å¼ (Adapter Pattern)

```python
# æŠ½è±¡æ¥å£
class DatabaseAdapter(ABC):
    @abstractmethod
    def add_strategy(self, ...): pass
    @abstractmethod  
    def get_active_strategies(self): pass
    # ... å…¶ä»–æ•°æ®åº“æ“ä½œ

# SQLiteå®ç° (æœ¬åœ°éƒ¨ç½²)
class SQLiteAdapter(DatabaseAdapter):
    def add_strategy(self, ...):
        # SQLiteå…·ä½“å®ç°
        
# Cloudflare D1å®ç° (äº‘ç«¯éƒ¨ç½²)  
class CloudflareD1Adapter(DatabaseAdapter):
    def add_strategy(self, ...):
        # D1 HTTP APIå®ç°
```

**ä¼˜åŠ¿**:
- âœ… ä¸šåŠ¡é€»è¾‘é›¶æ”¹åŠ¨
- âœ… æ•°æ®åº“æ— ç¼åˆ‡æ¢
- âœ… æ˜“äºæµ‹è¯•å’Œç»´æŠ¤

### 2. é…ç½®ç®¡ç†å±‚ (`config/manager.py`)

**è®¾è®¡æ¨¡å¼**: ç­–ç•¥æ¨¡å¼ + å•ä¾‹æ¨¡å¼

```python
class ConfigManager:
    # é…ç½®ä¼˜å…ˆçº§: ç¯å¢ƒå˜é‡ > é…ç½®æ–‡ä»¶ > é»˜è®¤å€¼
    def load_config(self):
        self._config = self._get_default_config()  # é»˜è®¤é…ç½®
        self._load_from_file()                     # é…ç½®æ–‡ä»¶
        self._load_from_env()                      # ç¯å¢ƒå˜é‡
```

**ä¼˜åŠ¿**:
- âœ… å¤šç¯å¢ƒç»Ÿä¸€ç®¡ç†
- âœ… 12-Factor App å…¼å®¹
- âœ… æœ¬åœ°å¼€å‘ + äº‘ç«¯ç”Ÿäº§

### 3. ä¸šåŠ¡é€»è¾‘å±‚

**ç»„ä»¶èŒè´£**:
- `StrategyManager`: ç­–ç•¥ç®¡ç†ï¼Œä»·æ ¼ç›‘æ§
- `DataFetcher`: å¤šAPIæ•°æ®è·å–ï¼Œå®¹é”™å¤„ç†  
- `EmailService`: é‚®ä»¶é€šçŸ¥æœåŠ¡
- `MonitorEngine`: ç›‘æ§å¼•æ“ï¼Œå®šæ—¶ä»»åŠ¡

**ç‰¹ç‚¹**:
- âœ… å®Œå…¨ç‹¬ç«‹äºéƒ¨ç½²æ–¹å¼
- âœ… æ¥å£è®¾è®¡æ¸…æ™°
- âœ… æ˜“äºå•å…ƒæµ‹è¯•

## ğŸš€ éƒ¨ç½²æ–¹å¼å¯¹æ¯”

| ç»„ä»¶ | æœ¬åœ°éƒ¨ç½² | Cloudflareéƒ¨ç½² | Dockeréƒ¨ç½² |
|------|---------|---------------|-----------|
| **å‰ç«¯** | Flaskæ¨¡æ¿ | Pagesé™æ€éƒ¨ç½² | Nginxé™æ€ |
| **åç«¯** | Flaskå¼€å‘æœåŠ¡å™¨ | Workers Serverless | Gunicorn |
| **æ•°æ®åº“** | SQLiteæ–‡ä»¶ | D1äº‘æ•°æ®åº“ | SQLite/PostgreSQL |
| **å®šæ—¶ä»»åŠ¡** | Cron/æ‰‹åŠ¨ | Cron Triggers | Docker Cron |
| **é…ç½®** | config.json | ç¯å¢ƒå˜é‡ | docker-compose.yml |
| **åŸŸå** | localhost:5000 | è‡ªå®šä¹‰åŸŸå | åå‘ä»£ç† |

## ğŸ”„ è¿ç§»æµç¨‹

### æœ¬åœ° â†’ Cloudflare

1. **æ•°æ®è¿ç§»**:
   ```bash
   sqlite3 stock_monitor.db .dump > backup.sql
   wrangler d1 execute stock-monitor-db --file=backup.sql
   ```

2. **é…ç½®æ›´æ–°**:
   ```bash
   export DB_TYPE=cloudflare_d1
   export DEPLOYMENT_TYPE=cloudflare
   ```

3. **éƒ¨ç½²**:
   ```bash
   cd deploy/cloudflare && ./deploy.sh
   ```

### Cloudflare â†’ æœ¬åœ°

1. **æ•°æ®å¯¼å‡º**:
   ```bash
   wrangler d1 export stock-monitor-db --output=backup.sql
   sqlite3 stock_monitor.db < backup.sql
   ```

2. **é…ç½®è¿˜åŸ**:
   ```json
   {"database": {"type": "sqlite"}, "deployment": {"type": "local"}}
   ```

## ğŸ¯ æŠ€æœ¯å†³ç­–

### ä¸ºä»€ä¹ˆé€‰æ‹©é€‚é…å™¨æ¨¡å¼ï¼Ÿ

1. **å¼€é—­åŸåˆ™**: å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å°é—­
2. **ä¾èµ–å€’ç½®**: é«˜å±‚ä¸šåŠ¡é€»è¾‘ä¸ä¾èµ–ä½å±‚æ•°æ®åº“å®ç°
3. **å•ä¸€èŒè´£**: æ¯ä¸ªé€‚é…å™¨åªè´Ÿè´£ä¸€ç§æ•°æ®åº“

### ä¸ºä»€ä¹ˆé€‰æ‹©é…ç½®ç®¡ç†å™¨ï¼Ÿ

1. **12-Factor App**: é…ç½®ä¸ä»£ç åˆ†ç¦»
2. **å¤šç¯å¢ƒæ”¯æŒ**: å¼€å‘/æµ‹è¯•/ç”Ÿäº§ç¯å¢ƒéš”ç¦»
3. **äº‘åŸç”Ÿ**: æ”¯æŒç¯å¢ƒå˜é‡æ³¨å…¥

### ä¸ºä»€ä¹ˆé€‰æ‹©Vue.jsï¼Ÿ

1. **æ¸è¿›å¼**: å¯ä»¥é€æ­¥è¿ç§»ï¼Œä¸ç ´åç°æœ‰ä»£ç 
2. **è½»é‡çº§**: å•æ–‡ä»¶ç»„ä»¶ï¼Œæ— éœ€å¤æ‚æ„å»º
3. **å“åº”å¼**: æ•°æ®é©±åŠ¨ï¼Œè‡ªåŠ¨æ›´æ–°

## ğŸ“ˆ æ‰©å±•æ€§

### æœªæ¥å¯æ‰©å±•çš„æ•°æ®åº“

```python
class PostgreSQLAdapter(DatabaseAdapter):
    # PostgreSQLå®ç°
    
class MongoAdapter(DatabaseAdapter):  
    # MongoDBå®ç°
    
class RedisAdapter(DatabaseAdapter):
    # Rediså®ç°
```

### æœªæ¥å¯æ‰©å±•çš„éƒ¨ç½²æ–¹å¼

- **AWS Lambda**: ç±»ä¼¼Cloudflare Workers
- **Google Cloud Run**: å®¹å™¨åŒ–Serverless
- **Azure Functions**: å¾®è½¯äº‘å‡½æ•°
- **Kubernetes**: å®¹å™¨ç¼–æ’

### æœªæ¥å¯æ‰©å±•çš„åŠŸèƒ½

- **WebSocket**: å®æ—¶ä»·æ ¼æ¨é€
- **GraphQL**: æ›´çµæ´»çš„APIæŸ¥è¯¢
- **æœºå™¨å­¦ä¹ **: ä»·æ ¼é¢„æµ‹å’Œæ™ºèƒ½æé†’
- **å¤šç§Ÿæˆ·**: æ”¯æŒå¤šç”¨æˆ·ç‹¬ç«‹æ•°æ®

## ğŸ”’ å®‰å…¨è€ƒè™‘

1. **é…ç½®å®‰å…¨**: æ•æ„Ÿä¿¡æ¯é€šè¿‡ç¯å¢ƒå˜é‡æ³¨å…¥
2. **APIå®‰å…¨**: CORSé…ç½®ï¼Œè¾“å…¥éªŒè¯
3. **æ•°æ®å®‰å…¨**: SQLæ³¨å…¥é˜²æŠ¤ï¼Œå‚æ•°åŒ–æŸ¥è¯¢
4. **ç½‘ç»œå®‰å…¨**: HTTPSå¼ºåˆ¶ï¼Œå®‰å…¨å¤´éƒ¨

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

1. **æ•°æ®åº“**: ç´¢å¼•ä¼˜åŒ–ï¼ŒæŸ¥è¯¢ç¼“å­˜
2. **API**: å“åº”å‹ç¼©ï¼Œé”™è¯¯å¤„ç†
3. **å‰ç«¯**: æ‡’åŠ è½½ï¼Œç»„ä»¶ç¼“å­˜  
4. **CDN**: é™æ€èµ„æºåŠ é€Ÿ

---

è¿™ä¸ªæ¶æ„è®¾è®¡ç¡®ä¿äº†**ä¸šåŠ¡é€»è¾‘ä¸éƒ¨ç½²æ–¹å¼çš„å®Œå…¨è§£è€¦**ï¼Œå¯ä»¥æ ¹æ®éœ€æ±‚åœ¨ä¸åŒéƒ¨ç½²æ–¹å¼é—´è‡ªç”±åˆ‡æ¢ï¼ŒåŒæ—¶ä¿æŒä»£ç çš„å¯ç»´æŠ¤æ€§å’Œæ‰©å±•æ€§ã€‚